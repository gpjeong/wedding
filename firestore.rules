rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // RSVP: 읽기 허용, 생성만 허용 (수정/삭제 불가)
    match /rsvp/{docId} {
      allow read: if true;
      allow create: if request.resource.data.name is string
                    && request.resource.data.name.size() > 0
                    && request.resource.data.name.size() <= 50
                    && request.resource.data.attendance is string;
      allow update, delete: if false;
    }

    // 방명록: 읽기 허용, 생성 허용, 삭제 허용 (비밀번호 일치 시)
    match /guestbook/{docId} {
      allow read: if true;
      allow create: if request.resource.data.name is string
                    && request.resource.data.name.size() > 0
                    && request.resource.data.name.size() <= 50
                    && request.resource.data.message is string
                    && request.resource.data.message.size() > 0
                    && request.resource.data.message.size() <= 500
                    && request.resource.data.password is string;
      allow delete: if true;
      allow update: if false;
    }

    // 그 외 모든 컬렉션 차단
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
